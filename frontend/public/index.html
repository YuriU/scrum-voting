<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />

    <title>Scrum Vote</title>
    <script>
            function getAllUrlParams(url) {

            // get query string from url (optional) or window
            var queryString = url ? url.split('?')[1] : window.location.search.slice(1);

            // we'll store the parameters here
            var obj = {};

            // if query string exists
            if (queryString) {

              // stuff after # is not part of query string, so get rid of it
              queryString = queryString.split('#')[0];

              // split our query string into its component parts
              var arr = queryString.split('&');

              for (var i = 0; i < arr.length; i++) {
                // separate the keys and the values
                var a = arr[i].split('=');

                // set parameter name and value (use 'true' if empty)
                var paramName = a[0];
                var paramValue = typeof (a[1]) === 'undefined' ? true : a[1];

                // (optional) keep case consistent
                paramName = paramName.toLowerCase();
                if (typeof paramValue === 'string') paramValue = paramValue.toLowerCase();

                // if the paramName ends with square brackets, e.g. colors[] or colors[2]
                if (paramName.match(/\[(\d+)?\]$/)) {

                  // create key if it doesn't exist
                  var key = paramName.replace(/\[(\d+)?\]/, '');
                  if (!obj[key]) obj[key] = [];

                  // if it's an indexed array e.g. colors[2]
                  if (paramName.match(/\[\d+\]$/)) {
                    // get the index value and add the entry at the appropriate position
                    var index = /\[(\d+)\]/.exec(paramName)[1];
                    obj[key][index] = paramValue;
                  } else {
                    // otherwise add the value to the end of the array
                    obj[key].push(paramValue);
                  }
                } else {
                  // we're dealing with a string
                  if (!obj[paramName]) {
                    // if it doesn't exist, create property
                    obj[paramName] = paramValue;
                  } else if (obj[paramName] && typeof obj[paramName] === 'string'){
                    // if property does exist and it's a string, convert it to an array
                    obj[paramName] = [obj[paramName]];
                    obj[paramName].push(paramValue);
                  } else {
                    // otherwise add the property
                    obj[paramName].push(paramValue);
                  }
                }
              }
            }

            return obj;
        }

        let params = getAllUrlParams();
        console.log(JSON.stringify(params));

        let sessionId = params.sessionid;
        let userId = params.userid;
        let baseUrl = "<BaseUrl>";
        var socket = new WebSocket(baseUrl + "?sessionid=" + sessionId +"&userid=" + userId);

        socket.onopen = function() {
          console.log('Connected');
        }

        socket.onclose = function(event) {
          if (event.wasClean) {
            console.log('Clean close');
          } else {
            console.log('connection issue')
          }
          console.log('Code: ' + event.code + ' Reason: ' + event.reason);
        };

        socket.onmessage = function(event) {
          console.log("Data received: " + event.data);
        };

        socket.onerror = function(error) {
          console.log("Error: " + error.message);
        };

    </script>
    <body>
        <noscript>You need to enable JavaScript to run this app.</noscript>
        <div id="root"></div>
      </body>
  </head>